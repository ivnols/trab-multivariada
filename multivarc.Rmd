---
title: "tutorial multivariada"
author: "Várias pessoas"
date: "7 de setembro de 2017"
output: html_document
---

Nesse tutorial você vai aprender a impressionar seus colegas de trabalho calculando uma PCA e visualizando os resultados em gráficos do `ggplot2` (ousadia e alegria). 
Pra isso, nós vamos usar o famosíssimo dataset `Iris` ~~da banda goo goo dolls~~ e a função `prcomp`. Não precisa instalar nada (por enquanto).

O dataset iris já vem no R, daí não precisa de muito drama (nada de `read.table` ou `read.csv` e tal, daí vou pular essa parte)

só precisa "falar"

```{r echo, eval=F}
iris
```
e ele aparece

```{r echo=F, eval=T}
head(iris)
```

Nessa parte é bom instalar logo os pacotes que vão ser usados, `ggplot2` e `ggfortify`, pra isso, é só seguir os passos abaixo:

Instala os bonecos
```{r echo=T, eval=F}
install.packages("ggplot2")
install.packages("ggfortify")
```

E carrega eles, depois
```{r echo=T, eval=T}
library(ggplot2)
library(ggfortify)
```
Esse aviso não é nada muito imporante, o `ggfortify` vai funcionar normalmente



##Agora começa a resenha

**Antes de tudo**

Se vc tentar fazer a PCA sem especificar quais colunas o R tem q ler, vai dar um erro, daí é bom criar um objeto que só tenha `valores`.

Fica um lance mais ou menos assim
```{r echo=F, eval=T}
iris.val=iris[c(1,2,3,4)]
```
```{r echo=F, eval=T}
head(iris.val)
```

Daí agora é só usar a função pra calcular a PCA
```{r echo=T, eval=T}
prcomp(iris.val,scale=T)
```

Nesse momento vc deve estar se perguntando *pq essxs queridxs resolveram usar o ggplot????*, bom, pq a gente pode... só isso mesmo. 
E vai ficar uma coisa mais ou menos assim

```{r echo=F,eval=T}
autoplot(prcomp(iris.val,scale=T))
```

Mas não tá bonito e não diz muita coisa, né? 
Vamo melhorar então, põe umas *true colors shining through*
```{r echo=F,eval=T}
autoplot(prcomp(iris.val,scale=T),data=iris,colour='Species')
```

Ficou mais legal, mas pode ficar AINDA mais, usando a função `frame=T`, assim:
```{r echo=T,eval=T}
autoplot(prcomp(iris.val,scale=T),data=iris,colour='Species',frame=T)
```

Daí o negócio fica mais maneiro.

####Galera, essa foi a primeira parte do tutorial de multivariadas no R, agora vem a segunda (isso mesmo) parte.

Agora você vai impressionar os seus amigos com esse script sensacional.
Seguindo o bonde, vamos continuar usando `iris` mesmo, pra não dar muito trabalho.

O passo agora é fazer um `nmds`. O famoso pacote `vegan` tem uma função pra isso, a `metaMDS`.

Primeiro é bom instalar o pacote...
```{r echo=T, eval=F}
install.packages("vegan")
```

E depois carrega o boneco
```{r echo=T,eval=T}
library(vegan)
```

Se você já pulou pra essa parte do tutorial, precisa fazer uma malandragem pra usar o dataset sem os nomes das espécies (tem outra forma de fazer isso lá no começo)

```{r echo=T, eval=T}
iris_data<-iris[ , 1:4]
```

####Agora começa a parte da análise em si.

Primeiro vamos criar uma matriz de distância com os valores de Iris
```{r echo=T, eval=T}
iris_data_euc<-vegdist(iris_data, method="euclidean")
```

Nós usamos duas funções, `try` e `trymax`, pra limitar o mínimo e o máximo de rodadas ou tentativas. 

A linha fica desse jeito
```{r echo=T, eval=T}
nmds.euc<-metaMDS(iris_data_euc, try=20, trymax=50)
```

Daí você quer ver um gráfico disso, certo?
```{r echo=T, eval=T}
plot(nmds.euc, type="t")
```

Eu sei... pode ser melhor. 
Aqui você poderia tentar o `ggplot`, como na análise anterior, mas eu vou passar pra vocês o que chamamos de modo oldschool...

Primeiro vamos dar nome aos bois (ou às plantas, sei lá...).

```{r echo=T,eval=F}
as.data.frame(iris[ ,5])
```

```{r echo=T, eval=T}
sp_iris=iris[,5]
```

Agora vamo fazer o gráfico *oldschool*

Primeiro escolhe as cores das espécies
```{r echo=T, eval=T}
cores.sp<-c("blue", "red", "green")
```

Agora, vamos ao gráfico

```{r echo=T,eval=F}
plot(nmds.euc, type="n")
points(nmds.euc, pch=16, col=cores.sp[sp_iris])
ordihull(nmds.euc,sp_iris, col=cores.sp)
```

Se executar cada linha dessas uma após a outra você vai ter mais ou menos isso

```{r echo=F,eval=T}
plot(nmds.euc, type="n")
points(nmds.euc, pch=16, col=cores.sp[sp_iris])
ordihull(nmds.euc,sp_iris, col=cores.sp)
```

Mas pode ficar mais legal, é só fazer o seguinte

```{r echo=T,eval=T}
envfit.euc<-envfit(nmds.euc, iris_data)
```

Depois isso aqui
```{r echo=T, eval=T}
envfit.euc
```

```{r echo=T, eval=T}
plot(envfit.euc,type="t")
```